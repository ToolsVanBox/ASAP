params {
    bam_fingerprint {
        bam_sort = true
    }
    bam_germline_copy_number_discovery_controlfreec {
        ploidy = 2
    }
    bam_germline_short_variant_discovery_haplotypecaller {
        gatk4variantrecalibrator_label = "known=false,training=true,truth=true,prior=10.0"
    }
    bam_markduplicates {
        bam_sort = true
    }
    bam_merge {
        bam_sort = true
    }
    bam_somatic_copy_number_discovery_controlfreec {
        ploidy = 2
    }
    bam_telomeres {
        bam_sort = true
    }
    bam_tumoronly_copy_number_discovery_controlfreec {
        ploidy = 2
    }
    fastq_align {
        bam_sort = true
    }
}

process {
    withName: 'CONTROLFREEC_MAKEBAFPLOT' {
        ext.args = ""
        ext.binsize = 1000
    }
    withName: 'CONTROLFREEC_MAKEKARYOTYPE' {
        ext.args = ""
        ext.ploidy = { "${params.bam_germline_copy_number_discovery_controlfreec.ploidy}" }
        ext.maxleveltoplot = 4
        ext.binsize = 50000
    }

    withName: 'GRIDSS_ANNOTATEINSERTEDSEQUENCE_SOMATIC' {
        ext.args = 'ALIGNMENT=APPEND'
    }
    withName: 'GRIDSS_ANNOTATEINSERTEDSEQUENCE_TUMORONLY' {
        ext.args = 'ALIGNMENT=APPEND'
    }
    withName: 'GRIDSS_ANNOTATEINSERTEDSEQUENCE_GERMLINE' {
        ext.args = 'ALIGNMENT=APPEND'
    }

    withName: 'GRIDSS_SOMATIC' {
        ext.args = '--maxcoverage 200'
    }
    withName: 'GRIDSS_TUMORONLY' {
        ext.args = '--maxcoverage 200'
    }
    withName: 'GRIDSS_GERMLINE' {
        ext.args = '--maxcoverage 200'
    }

    withName: 'HMFTOOLS_AMBER_SOMATIC' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_AMBER_TUMORONLY' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_AMBER_GERMLINE' {
        ext.args = '-ref_genome_version 38'
    }

    withName: 'HMFTOOLS_COBALT_SOMATIC' {
        ext.args = ''
    }
    withName: 'HMFTOOLS_COBALT_TUMORONLY' {
        ext.args = ''
    }
    withName: 'HMFTOOLS_COBALT_GERMLINE' {
        ext.args = ''
    }

    withName: 'HMFTOOLS_GRIPSS_SOMATIC' {
        ext.args = ''
        //ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_GRIPSS_TUMORONLY' {
        ext.args = ''
        //ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_GRIPSS_GERMLINE' {
        ext.args = ''
        //ext.args = '-ref_genome_version 38'
    }

    withName: 'HMFTOOLS_LINX_SOMATIC' {
        ext.args = '-ref_genome_version 38 -check_fusions -check_drivers -write_vis_data'
    }
    withName: 'HMFTOOLS_LINX_TUMORONLY' {
        ext.args = '-ref_genome_version 38 -check_fusions -check_drivers -write_vis_data'
    }
    withName: 'HMFTOOLS_LINX_GERMLINE' {
        ext.args = '-ref_genome_version 38 -check_fusions -check_drivers -write_vis_data'
    }

    withName: 'HMFTOOLS_LINX_SVVISUALISER_SOMATIC' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_LINX_SVVISUALISER_TUMORONLY' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_LINX_SVVISUALISER_GERMLINE' {
        ext.args = '-ref_genome_version 38'
    }

    withName: 'HMFTOOLS_PURPLE_SOMATIC' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_PURPLE_TUMORONLY' {
        ext.args = '-ref_genome_version 38'
    }
    withName: 'HMFTOOLS_PURPLE_GERMLINE' {
        ext.args = '-ref_genome_version 38'
    }

    withName: 'SMURF' {
        ext.args         = "" 
        ext.prefix       = ""
        ext.config       = { "${projectDir}/configs/modules/local/SMuRF/config_15cov.ini" }        
    }

    withName: 'TELOMERECAT_BAM2LENGTH' {
        ext.args = ''
    }
    
    withName: 'TELSEQ' {
        ext.args = { "-m" }        
    }
    

    withName: 'BCFTOOLS_SORT' {
        ext.args         = ''
        ext.prefix       = { "${meta.id}.sorted" }        
    }
    
    withName: 'BWA_INDEX' {
        ext.args         = ''
    }
    withName: 'BWA_MEM' {
        ext.args = { "-M -c 100 -R ${meta.read_group}" }
        ext.prefix = { "" }        
    }

    withName: 'BWAMEM2_INDEX' {
        ext.args         = ''        
    }    
    withName: 'BWAMEM2_MEM' {
        ext.args = { "-M -c 100 -R ${meta.read_group}" }
        ext.prefix = { "" }
    }   

    withName: 'CONTROLFREEC_ASSESSSIGNIFICANCE' {
        ext.args         = ''
    }
    withName: 'CONTROLFREEC_FREEC2BED' {
        ext.args         = ''
    }
    withName: 'CONTROLFREEC_FREEC2CIRCOS' {
        ext.args         = ''
    }
    withName: 'CONTROLFREEC_MAKEGRAPH' {
        ext.args         = ''
    }
    withName: 'FREEC_GERMLINE' {
        ext.args = {[
                "sample":[
                    inputformat: 'pileup',
                    mateorientation: 'FR'
                ],
                "general" :[
                    bedgraphoutput: "TRUE",
                    breakpointthreshold: "",
                    breakpointtype: "",
                    coefficientofvariation: "",
                    contamination: "",
                    contaminationadjustment: "",
                    forcegccontentnormalization: "",
                    minimalsubclonepresence: "",
                    noisydata: "",
                    ploidy: "${params.bam_germline_copy_number_discovery_controlfreec.ploidy}",
                    printNA: "",
                    readcountthreshold: "",
                    window: "1000"
                    ],
                "BAF":[
                    minimalcoverageperposition: "",
                    minimalqualityperposition: "",
                    //"shiftinquality": (optional)not set
                ]
            ]
        }
    }
    withName: 'FREEC_TUMORONLY' {
        ext.args = {[
                "sample":[
                    inputformat: 'pileup',
                    mateorientation: 'FR'
                ],
                "general" :[
                    bedgraphoutput: "TRUE",
                    breakpointthreshold: "",
                    breakpointtype: "",
                    coefficientofvariation: "",
                    contamination: "",
                    contaminationadjustment: "",
                    forcegccontentnormalization: "",
                    minimalsubclonepresence: "",
                    noisydata: "",
                    ploidy: "${params.bam_germline_copy_number_discovery_controlfreec.ploidy}",
                    printNA: "",
                    readcountthreshold: "",
                    window: "1000"
                    ],
                "BAF":[
                    minimalcoverageperposition: "",
                    minimalqualityperposition: "",
                    //"shiftinquality": (optional)not set
                ]
            ]
        }
    }
    withName: 'FREEC_SOMATIC' {
        ext.args = {[
                "sample":[
                    inputformat: 'pileup',
                    mateorientation: 'FR'
                ],
                "control":[
                    inputformat: "pileup",
                    mateorientation: "FR"
                ],
                "general" :[
                    bedgraphoutput: "TRUE",
                    breakpointthreshold: "0.8",
                    breakpointtype: "2",
                    coefficientofvariation: "",
                    contamination: "",
                    contaminationadjustment: "",
                    forcegccontentnormalization: "0",
                    minimalsubclonepresence: "20",
                    noisydata: "FALSE",
                    ploidy: "2",
                    printNA: "TRUE",
                    readcountthreshold: "10",
                    window: "1000"
                    ],
                "BAF":[
                    minimalcoverageperposition: "",
                    minimalqualityperposition: "",
                    //"shiftinquality": (optional)not set
                ]
            ]
        }
    }

    withName: 'CUSTOM_DUMPSOFTWAREVERSIONS' {
        ext.args         = ''
    }

    withName: 'FASTQC' {
        ext.args         = '--quiet'
    }

    withName: 'GATK4_APPLYBQSR' {
        ext.args         = ''
    }
    withName: 'GATK4_APPLYVQSR_INDEL' {        
        ext.args         = { "--truth-sensitivity-filter-level 99.9 -mode INDEL" }
        ext.prefix       = { "${meta.id}.vqsr.indel" }
    }
    withName: 'GATK4_APPLYVQSR_SNP' {        
        ext.args         = { "--truth-sensitivity-filter-level 99.9 -mode SNP" }
        ext.prefix       = { "${meta.id}.vqsr.snp" }
    }
    withName: 'GATK4_BASERECALIBRATOR' {
        ext.args         = ''
    }
    withName: 'GATK4_CALCULATECONTAMINATION' {
        ext.args         = { "-tumor-segmentation ${meta.id}.mutect2.segmentation.table" }
    }
    withName: 'GATK4_COMBINEGVCFS' {
        ext.args         = ''
    }
    withName: 'GATK4_FILTERMUTECTCALLS' {
        ext.args         = ''
    }
    withName: 'GATK4_GENOMICSDBIMPORT' {
        ext.args         = { "--genomicsdb-shared-posixfs-optimizations true --bypass-feature-reader " }
    }
    withName: 'GATK4_GENOTYPEGVCFS' {
        ext.args         = ''
    }
    withName: 'GATK4_GETPILEUPSUMMARIES' {
        ext.args         = ''
    }
    withName: 'GATK4_HAPLOTYPECALLER' {
        ext.args         = '-ERC GVCF'
    }
    withName: 'GATK4_LEARNREADORIENTATIONMODEL' {
        ext.args         = ''
    }
    withName: 'GATK4_MARKDUPLICATES' {
        ext.args         = ''
    }
    withName: 'GATK4_MARKDUPLICATES_SPARK' {
        ext.args         = ''
    }
    withName: 'GATK4_MERGEVCFS_GENOTYPEGVCFS' {
        ext.args         = ''
    }
    withName: 'GATK4_MERGEVCFS_VQSR' {
        ext.args         = ''
        ext.prefix       = { "${meta.id}.vqsr" }
    }
    withName: 'GATK4_MUTECT2' {
        ext.args         = {"--f1r2-tar-gz ${meta.id}.f1r2.tar.gz" }
    }
    withName: 'GATK4_SPLITINTERVALS' {
        ext.args         = '--scatter-count 21'
    }
    withName: 'GATK4_VARIANTFILTRATION' {        
        ext.args         = { "--filter-expression 'QD < 2.0' --filter-expression 'MQ < 40.0' --filter-expression 'FS > 60.0' --filter-expression 'HaplotypeScore > 13.0' --filter-expression 'MQRankSum < -12.5' --filter-expression 'ReadPosRankSum < -8.0' --filter-expression 'MQ0 >= 4 && ((MQ0 / (1.0 * DP)) > 0.1)' --filter-expression 'DP < 5' --filter-expression 'QUAL < 30' --filter-expression 'QUAL >= 30.0 && QUAL < 50.0' --filter-expression 'SOR > 4.0' --filter-name 'SNP_LowQualityDepth' --filter-name 'SNP_MappingQuality' --filter-name 'SNP_StrandBias' --filter-name 'SNP_HaplotypeScoreHigh' --filter-name 'SNP_MQRankSumLow' --filter-name 'SNP_ReadPosRankSumLow' --filter-name 'SNP_HardToValidate' --filter-name 'SNP_LowCoverage' --filter-name 'SNP_VeryLowQual' --filter-name 'SNP_LowQual' --filter-name 'SNP_SOR' -cluster 3 -window 10" }
        ext.prefix       = { "${meta.id}.filtered" }
    }
    withName: 'GATK4_VARIANTRECALIBRATOR_INDEL' {        
        ext.args         = { "-an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode INDEL" }
    }
    withName: 'GATK4_VARIANTRECALIBRATOR_SNP' {        
        ext.args         = { "-an QD -an MQ -an MQRankSum -an ReadPosRankSum -an FS -an SOR -mode SNP" }
    }

    withName: 'MANTA_SOMATIC' {
        ext.args = ''
    }
    withName: 'MANTA_TUMORONLY' {
        ext.args = ''
    }
    withName: 'MANTA_GERMLINE' {
        ext.args = ''
    }

    withName: 'MULTIQC' {
        ext.args         = ''
    }

    withName: 'PICARD_COLLECTHSMETRICS' {
        ext.args         = ''
    }
    withName: 'PICARD_COLLECTMULTIPLEMETRICS' {
        ext.args         = ''
    }
    withName: 'PICARD_COLLECTWGSMETRICS' {
        ext.args         = ''
    }
    withName: 'PICARD_CROSSCHECKFINGERPRINTS' {
        ext.args         = { "--CROSSCHECK_BY SAMPLE --EXIT_CODE_WHEN_MISMATCH 0 --EXPECT_ALL_GROUPS_TO_MATCH true" }
        ext.prefix = { "${meta.id}.picard_crosscheckfingerprints" }
    }
    withName: 'PICARD_MARKDUPLICATES' {
        ext.args         = ''
    }
    
    withName: 'SAMTOOLS_COLLATE' {
        ext.args = '--output-fmt bam'
    }
    withName: 'SAMTOOLS_CONVERT' {
        ext.args = { "" }
    }
    withName: 'SAMTOOLS_FIXMATE' {
        ext.args = '-m' 
        ext.prefix =  { "${meta.id}.fixmate" }          
    }
    withName: 'SAMTOOLS_FLAGSTAT' {
        ext.args = '' 
    }
    withName: 'SAMTOOLS_IDXSTATS' {
        ext.args = ''
    }
    withName: 'SAMTOOLS_INDEX' {
        ext.args = '' 
    }
    withName: 'SAMTOOLS_MARKDUP' {
        ext.args         = ''
    }
    withName: 'SAMTOOLS_MERGE' {        
        ext.args = ''
    }
    withName: 'SAMTOOLS_SORT' {
        ext.args = ''        
        ext.prefix = { "${meta.id}.sorted" }        
    }
    withName: 'SAMTOOLS_STATS' {
        ext.args = ''
    }

    withName: 'SNPEFF_SNPEFF' {
        ext.args = '-hgvs -lof -no-downstream -no-upstream -no-intergenic'
    }

    withName: 'ENSEMBLVEP_VEP' {
        ext.args = { "--vcf --plugin AlphaMissense,file=${params.genomes[params.genome].vep_AlphaMissense} --plugin NMD --plugin dbNSFP,${params.genomes[params.genome].vep_dbNSFP},ALL --offline" }
    }

    withName: 'SNPSIFT_SPLIT' {
        ext.args         = { "-l 1000" }
        ext.prefix       = { }
    }
    withName: 'SNPSIFT_JOIN_.*' {
        ext.args         = { }
        ext.prefix       = { }
    }

    withName: 'TABIX_BGZIPTABIX' {
        ext.args = ''
        ext.prefix = { "${meta.id}" }
    }
    withName: 'GATK_UNIFIEDGENOTYPER' {
        ext.args = '--output_mode EMIT_ALL_SITES'
    }
}
